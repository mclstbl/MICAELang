<!DOCTYPE html>

<html>
<head>
  <title>example.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>example.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * This file provided by Facebook is for non-commercial testing and evaluation
 * purposes only. Facebook reserves all rights not expressly granted.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * FACEBOOK BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */</span>

<span class="hljs-keyword">var</span> Comment = React.createClass({
  rawMarkup: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> rawMarkup = marked(<span class="hljs-keyword">this</span>.props.children.toString(), {sanitize: <span class="hljs-literal">true</span>});
    <span class="hljs-keyword">return</span> { __html: rawMarkup };
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"comment"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"commentAuthor"</span>&gt;</span>
          {this.props.author}
        <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{this.rawMarkup()}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    );
  }
});

var CommentBox = React.createClass({
  loadCommentsFromServer: function() {
    $.ajax({
      url: this.props.url,
      dataType: 'json',
      cache: false,
      success: function(data) {
        this.setState({data: data});
      }.bind(this),
      error: function(xhr, status, err) {
        console.error(this.props.url, status, err.toString());
      }.bind(this)
    });
  },
  handleCommentSubmit: function(comment) {
    var comments = this.state.data;
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Optimistically set an id on the new comment. It will be replaced by an
id generated by the server. In a production application you would likely
not use Date.now() for this and would have a more robust system in place.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    comment.id = <span class="hljs-built_in">Date</span>.now();
    <span class="hljs-keyword">var</span> newComments = comments.concat([comment]);
    <span class="hljs-keyword">this</span>.setState({data: newComments});
    $.ajax({
      url: <span class="hljs-keyword">this</span>.props.url,
      dataType: <span class="hljs-string">'json'</span>,
      type: <span class="hljs-string">'POST'</span>,
      data: comment,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">this</span>.setState({data: data});
      }.bind(<span class="hljs-keyword">this</span>),
      error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, status, err</span>) </span>{
        <span class="hljs-keyword">this</span>.setState({data: comments});
        <span class="hljs-built_in">console</span>.error(<span class="hljs-keyword">this</span>.props.url, status, err.toString());
      }.bind(<span class="hljs-keyword">this</span>)
    });
  },
  getInitialState: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> {data: []};
  },
  componentDidMount: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.loadCommentsFromServer();
    setInterval(<span class="hljs-keyword">this</span>.loadCommentsFromServer, <span class="hljs-keyword">this</span>.props.pollInterval);
  },
  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (
      &lt;div className="commentBox"&gt;
        &lt;h1&gt;Comments&lt;/h1&gt;
        &lt;CommentList data={this.state.data} /&gt;
        &lt;CommentForm onCommentSubmit={this.handleCommentSubmit} /&gt;
      &lt;/div&gt;
    );
  }
});

var CommentList = React.createClass({
  render: function() {
    var commentNodes = this.props.data.map(function(comment) {
      return (
        &lt;Comment author={comment.author} key={comment.id}&gt;
          {comment.text}
        &lt;/Comment&gt;
      );
    });
    return (
      &lt;div className="commentList"&gt;
        {commentNodes}
      &lt;/div&gt;
    );
  }
});

var CommentForm = React.createClass({
  getInitialState: function() {
    return {author: '', text: ''};
  },
  handleAuthorChange: function(e) {
    this.setState({author: e.target.value});
  },
  handleTextChange: function(e) {
    this.setState({text: e.target.value});
  },
  handleSubmit: function(e) {
    e.preventDefault();
    var author = this.state.author.trim();
    var text = this.state.text.trim();
    if (!text || !author) {
      return;
    }
    this.props.onCommentSubmit({author: author, text: text});
    this.setState({author: '', text: ''});
  },
  render: function() {
    return (
      &lt;form className="commentForm" onSubmit={this.handleSubmit}&gt;
        &lt;input
          type="text"
          placeholder="Your name"
          value={this.state.author}
          onChange={this.handleAuthorChange}
        /&gt;
        &lt;input
          type="text"
          placeholder="Say something..."
          value={this.state.text}
          onChange={this.handleTextChange}
        /&gt;
        &lt;input type="submit" value="Post" /&gt;
      &lt;/form&gt;
    );
  }
});

ReactDOM.render(
  &lt;CommentBox url="/api/comments" pollInterval={2000} /&gt;,
  document.getElementById('content')
);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
